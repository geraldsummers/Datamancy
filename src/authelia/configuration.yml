# Authelia v4 â€“ dev-friendly config for *.lab.localhost
# Works with Caddy forward-auth and LibreChat OIDC.

server:
  address: 0.0.0.0
  port: 9091

log:
  level: info

theme: light

totp:
  issuer: lab.localhost

session:
  name: authelia_session
  secret: "CHANGE_ME_SESSION_SECRET"     # e.g. base64 32+ bytes
  same_site: lax
  expiration: 3600s
  inactivity: 300s
  cookies:
    - domain: lab.localhost
      authelia_url: https://id.lab.localhost

storage:
  local:
    path: /data/db.sqlite3

notifier:
  filesystem:
    filename: /data/notification.txt

authentication_backend:
  file:
    path: /config/users.yml
    search:
      email: true
    password:
      algorithm: argon2id
      iterations: 1
      key_length: 32
      salt_length: 16
      memory: 65536
      parallelism: 4

access_control:
  default_policy: deny
  rules:
    - domain:
        - "lab.localhost"
        - "*.lab.localhost"
      policy: one_factor   # dev: single factor; change to two_factor later

identity_providers:
  oidc:
    # Minimal OIDC so LibreChat can log in via Authelia
    hmac_secret: "CHANGE_ME_OIDC_HMAC"    # base64 32+ bytes
    issuer_private_key: |-
      -----BEGIN RSA PRIVATE KEY-----
      PASTE_YOUR_2048b_RSA_PRIVATE_KEY_HERE
      -----END RSA PRIVATE KEY-----
    access_token_lifespan: 1h
    refresh_token_lifespan: 90d
    authorize_code_lifespan: 1m
    minimum_parameter_entropy: 14
    clients:
      - id: librechat
        description: LibreChat
        secret: "CHANGE_ME_LIBRECHAT_SECRET"     # must match .env LIBRECHAT_OIDC_CLIENT_SECRET
        public: false
        authorization_policy: one_factor
        redirect_uris:
          - https://chat.lab.localhost/oidc/callback
        scopes:
          - openid
          - profile
          - email
        grant_types:
          - authorization_code
          - refresh_token
        response_types:
          - code
        token_endpoint_auth_method: client_secret_post
