credentials:
  - name: DOMAIN
    type: config_value
    description: "Primary domain for the stack"
    source: datamancy.config.yaml

  - name: MAIL_DOMAIN
    type: config_value
    description: "Mail server domain"
    source: datamancy.config.yaml

  - name: LDAP_DOMAIN
    type: config_value
    description: "LDAP domain"
    source: datamancy.config.yaml

  - name: LDAP_BASE_DN
    type: config_value
    description: "LDAP base DN"
    source: datamancy.config.yaml

  - name: STACK_ADMIN_EMAIL
    type: config_value
    description: "Administrator email address"
    source: datamancy.config.yaml

  - name: STACK_ADMIN_USER
    type: config_value
    description: "Shared admin username for all GUI applications"
    source: datamancy.config.yaml

  - name: STACK_ADMIN_PASSWORD
    type: hex_secret
    description: "Shared admin password for all GUI applications"
    used_by:
      - homeassistant
      - bookstack
      - grafana
      - open_webui
      - planka
      - mastodon
      - vaultwarden
      - forgejo
      - jupyterhub
      - kopia
      - homepage
      - seafile
      - roundcube
      - synapse
      - lam
      - litellm
      - dozzle
    hash_variants:
      - algorithm: ssha
        variable: ADMIN_SSHA_PASSWORD
        used_in: [configs/ldap/bootstrap_ldap.ldif]

  - name: POSTGRES_ADMIN_USER
    type: config_value
    description: "PostgreSQL superuser username"
    default: "postgres"

  - name: POSTGRES_ADMIN_PASSWORD
    type: hex_secret
    description: "PostgreSQL superuser password"
    used_by:
      - postgres
      - init_scripts

  - name: MARIADB_ADMIN_USER
    type: config_value
    description: "MariaDB root username"
    default: "root"

  - name: MARIADB_ADMIN_PASSWORD
    type: hex_secret
    description: "MariaDB root password"
    used_by:
      - mariadb
      - init_scripts

  - name: LDAP_ADMIN_USER
    type: config_value
    description: "LDAP admin bind DN (derived from LDAP_BASE_DN)"
    default: "cn=admin,${LDAP_BASE_DN}"

  - name: LDAP_ADMIN_PASSWORD
    type: hex_secret
    description: "LDAP admin bind password"
    used_by:
      - authelia
      - ldap
      - mailserver
      - synapse
      - lam
      - homeassistant
      - forgejo
    baked_in_configs:
      - configs/mailserver/ldap-domains.cf
      - configs/mailserver/dovecot-ldap.conf.ext

  - name: VALKEY_ADMIN_PASSWORD
    type: hex_secret
    description: "Valkey (Redis) admin password"
    used_by:
      - valkey

  - name: VALKEY_AUTHELIA_PASSWORD
    type: hex_secret
    description: "Valkey password for Authelia service"

  - name: VALKEY_SEAFILE_PASSWORD
    type: hex_secret
    description: "Valkey password for Seafile service"

  - name: VALKEY_MASTODON_PASSWORD
    type: hex_secret
    description: "Valkey password for Mastodon service"

  - name: QDRANT_ADMIN_API_KEY
    type: hex_secret
    description: "Qdrant admin API key (full access)"
    used_by:
      - qdrant
      - search_service
      - bootstrap_scripts

  - name: POSTGRES_AUTHELIA_USER
    type: config_value
    description: "PostgreSQL user for Authelia service"
    default: "authelia"

  - name: POSTGRES_AUTHELIA_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Authelia service"

  - name: POSTGRES_GRAFANA_USER
    type: config_value
    description: "PostgreSQL user for Grafana service"
    default: "grafana"

  - name: POSTGRES_GRAFANA_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Grafana service"

  - name: POSTGRES_PLANKA_USER
    type: config_value
    description: "PostgreSQL user for Planka service"
    default: "planka"

  - name: POSTGRES_PLANKA_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Planka service"

  - name: POSTGRES_SYNAPSE_USER
    type: config_value
    description: "PostgreSQL user for Matrix Synapse service"
    default: "synapse"

  - name: POSTGRES_SYNAPSE_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Matrix Synapse service"

  - name: POSTGRES_VAULTWARDEN_USER
    type: config_value
    description: "PostgreSQL user for Vaultwarden service"
    default: "vaultwarden"

  - name: POSTGRES_VAULTWARDEN_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Vaultwarden service"

  - name: POSTGRES_OPENWEBUI_USER
    type: config_value
    description: "PostgreSQL user for Open WebUI service"
    default: "openwebui"

  - name: POSTGRES_OPENWEBUI_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Open WebUI service"

  - name: POSTGRES_MASTODON_USER
    type: config_value
    description: "PostgreSQL user for Mastodon service"
    default: "mastodon"

  - name: POSTGRES_MASTODON_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Mastodon service"

  - name: POSTGRES_FORGEJO_USER
    type: config_value
    description: "PostgreSQL user for Forgejo service"
    default: "forgejo"

  - name: POSTGRES_FORGEJO_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Forgejo service"

  - name: POSTGRES_ROUNDCUBE_USER
    type: config_value
    description: "PostgreSQL user for Roundcube service"
    default: "roundcube"

  - name: POSTGRES_ROUNDCUBE_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Roundcube service"

  - name: POSTGRES_HOMEASSISTANT_USER
    type: config_value
    description: "PostgreSQL user for Home Assistant service"
    default: "homeassistant"

  - name: POSTGRES_HOMEASSISTANT_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Home Assistant service"

  - name: POSTGRES_DATAMANCY_USER
    type: config_value
    description: "PostgreSQL user for Datamancy services (pipeline, search, test-runner)"
    default: "datamancer"

  - name: POSTGRES_DATAMANCY_PASSWORD
    type: hex_secret
    description: "PostgreSQL password for Datamancy services"
    used_by:
      - pipeline
      - search_service
      - test_runner

  - name: MARIADB_BOOKSTACK_USER
    type: config_value
    description: "MariaDB user for BookStack service"
    default: "bookstack"

  - name: MARIADB_BOOKSTACK_PASSWORD
    type: hex_secret
    description: "MariaDB password for BookStack service"

  - name: MARIADB_SEAFILE_USER
    type: config_value
    description: "MariaDB user for Seafile service"
    default: "seafile"

  - name: MARIADB_SEAFILE_PASSWORD
    type: hex_secret
    description: "MariaDB password for Seafile service"

  - name: POSTGRES_AGENT_USER
    type: config_value
    description: "PostgreSQL read-only user for agent access"
    default: "agent_observer"

  - name: POSTGRES_AGENT_PASSWORD
    type: hex_secret
    description: "PostgreSQL read-only password for agent access"

  - name: MARIADB_AGENT_USER
    type: config_value
    description: "MariaDB read-only user for agent access"
    default: "agent_observer"

  - name: MARIADB_AGENT_PASSWORD
    type: hex_secret
    description: "MariaDB read-only password for agent access"

  - name: LDAP_AGENT_USER
    type: config_value
    description: "LDAP read-only user for agent access"
    default: "cn=agent_observer,${LDAP_BASE_DN}"

  - name: LDAP_AGENT_PASSWORD
    type: hex_secret
    description: "LDAP read-only password for agent access"

  - name: QDRANT_AGENT_API_KEY
    type: hex_secret
    description: "Qdrant read-only API key for agent access"

  - name: PGADMIN_OAUTH_SECRET
    type: oauth_secret
    description: "PgAdmin OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: PGADMIN_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: OPENWEBUI_OAUTH_SECRET
    type: oauth_secret
    description: "Open WebUI OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: OPENWEBUI_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: DIM_OAUTH_SECRET
    type: oauth_secret
    description: "DIM OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: DIM_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: PLANKA_OAUTH_SECRET
    type: oauth_secret
    description: "Planka OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: PLANKA_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: VAULTWARDEN_OAUTH_SECRET
    type: oauth_secret
    description: "Vaultwarden OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: VAULTWARDEN_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: MASTODON_OAUTH_SECRET
    type: oauth_secret
    description: "Mastodon OIDC provider secret (for Authelia)"
    hash_variants:
      - algorithm: argon2id
        variable: MASTODON_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: BOOKSTACK_OAUTH_SECRET
    type: oauth_secret
    description: "BookStack OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: BOOKSTACK_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: FORGEJO_OAUTH_SECRET
    type: oauth_secret
    description: "Forgejo OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: FORGEJO_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: MATRIX_OAUTH_SECRET
    type: oauth_secret
    description: "Matrix Synapse OIDC client secret"
    hash_variants:
      - algorithm: argon2id
        variable: MATRIX_OAUTH_SECRET_HASH
        used_in: [configs/authelia/configuration.yml]

  - name: AUTHELIA_JWT_SECRET
    type: hex_secret
    description: "Authelia JWT signing secret"

  - name: AUTHELIA_SESSION_SECRET
    type: hex_secret
    description: "Authelia session encryption secret"

  - name: AUTHELIA_STORAGE_ENCRYPTION_KEY
    type: hex_secret
    description: "Authelia storage encryption key"

  - name: AUTHELIA_OIDC_HMAC_SECRET
    type: hex_secret
    description: "Authelia OIDC HMAC secret"

  - name: AUTHELIA_OIDC_PRIVATE_KEY
    type: rsa_key
    description: "Authelia OIDC RSA private key"
    special_handling: multiline_indented_yaml

  - name: BOOKSTACK_APP_KEY
    type: laravel_key
    description: "BookStack Laravel application key"

  - name: BOOKSTACK_API_TOKEN_ID
    type: hex_secret
    description: "BookStack API token ID for pipeline automation"
    used_by:
      - pipeline
      - bookstack

  - name: BOOKSTACK_API_TOKEN_SECRET
    type: hex_secret
    description: "BookStack API token secret for pipeline automation"
    used_by:
      - pipeline
      - bookstack

  - name: JELLYFIN_OIDC_SECRET
    type: hex_secret
    description: "Jellyfin OIDC secret"

  - name: JUPYTERHUB_CRYPT_KEY
    type: hex_secret
    description: "JupyterHub encryption key"

  - name: LITELLM_MASTER_KEY
    type: hex_secret
    description: "LiteLLM master API key"

  - name: ONLYOFFICE_JWT_SECRET
    type: hex_secret
    description: "OnlyOffice JWT secret"

  - name: PLANKA_SECRET_KEY
    type: hex_secret
    description: "Planka secret key"

  - name: SEAFILE_JWT_KEY
    type: hex_secret
    description: "Seafile JWT key"

  - name: SEAFILE_SECRET_KEY
    type: hex_secret
    description: "Seafile secret key"

  - name: SEAFILE_EMAIL_PASSWORD
    type: hex_secret
    description: "Seafile email notification password"

  - name: VAULTWARDEN_ADMIN_TOKEN
    type: hex_secret
    description: "Vaultwarden admin panel token"

  - name: VAULTWARDEN_SMTP_PASSWORD
    type: hex_secret
    description: "Vaultwarden SMTP password"

  - name: NTFY_USERNAME
    type: config_value
    description: "NTFY service username for alertmanager authentication"
    default: "alertmanager"

  - name: NTFY_PASSWORD
    type: hex_secret
    description: "NTFY service password for alertmanager authentication"

  - name: NTFY_ADMIN_USER
    type: config_value
    description: "NTFY admin username"
    default: "admin"

  - name: NTFY_ADMIN_PASSWORD
    type: hex_secret
    description: "NTFY admin password"

  - name: SYNAPSE_REGISTRATION_SECRET
    type: hex_secret
    description: "Matrix Synapse registration secret"

  - name: SYNAPSE_MACAROON_SECRET
    type: hex_secret
    description: "Matrix Synapse macaroon secret"

  - name: SYNAPSE_FORM_SECRET
    type: hex_secret
    description: "Matrix Synapse form secret"

  - name: MASTODON_SECRET_KEY_BASE
    type: hex_secret
    description: "Mastodon secret key base"

  - name: MASTODON_OTP_SECRET
    type: hex_secret
    description: "Mastodon OTP secret"

  - name: MASTODON_VAPID_PRIVATE_KEY
    type: hex_secret
    description: "Mastodon VAPID private key"

  - name: MASTODON_VAPID_PUBLIC_KEY
    type: hex_secret
    description: "Mastodon VAPID public key"

  - name: MASTODON_OIDC_SECRET
    type: hex_secret
    description: "Mastodon OIDC client secret (for authenticating to Authelia)"

  - name: MASTODON_ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY
    type: hex_secret
    description: "Mastodon ActiveRecord encryption primary key"

  - name: MASTODON_ACTIVE_RECORD_ENCRYPTION_DETERMINISTIC_KEY
    type: hex_secret
    description: "Mastodon ActiveRecord encryption deterministic key"

  - name: MASTODON_ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT
    type: hex_secret
    description: "Mastodon ActiveRecord encryption salt"

  - name: HUGGINGFACEHUB_API_TOKEN
    type: user_provided
    description: "HuggingFace Hub API token (required for model downloads)"
    default: ""

  - name: FORGEJO_RUNNER_REGISTRATION_TOKEN
    type: user_provided
    description: "Forgejo CI runner registration token (generated post-deployment)"
    default: ""

  - name: API_LITELLM_ALLOWLIST
    type: config_value
    description: "IP allowlist for LiteLLM API"
    default: "127.0.0.1 172.16.0.0/12 192.168.0.0/16"

  - name: VECTOR_EMBED_SIZE
    type: config_value
    description: "Vector embedding dimension (BAAI/bge-m3)"
    default: "1024"

  - name: FORGEJO_RUNNER_NAME
    type: config_value
    description: "Forgejo runner instance name"
    default: "datamancy-runner"

  - name: FORGEJO_RUNNER_LABELS
    type: config_value
    description: "Forgejo runner labels"
    default: "ubuntu-latest:docker://node:20-bullseye,ubuntu-22.04:docker://node:20-bullseye"

template_rules:
  - name: ldap_bootstrap
    path_pattern: "ldap/bootstrap_ldap.ldif"
    substitutions:
      ADMIN_SSHA_PASSWORD:
        source: STACK_ADMIN_PASSWORD
        transform: ssha
      USER_SSHA_PASSWORD:
        source: STACK_ADMIN_PASSWORD
        transform: ssha

  - name: mailserver_ldap
    path_pattern: "mailserver/(ldap-domains.cf|dovecot-ldap.conf.ext)"
    substitutions:
      LDAP_ADMIN_PASSWORD:
        transform: none
    then_convert_remaining: true

  - name: authelia_oidc_key
    path_pattern: "authelia/configuration.yml"
    substitutions:
      AUTHELIA_OIDC_PRIVATE_KEY:
        transform: multiline_yaml_indent

  - name: default
    path_pattern: ".*"
    substitutions: {}
    then_convert_remaining: true
