# MkDocs â€” Spoke

**Status:** ðŸŸ¡ In Progress
**Phase:** 0.5 â€” Docs Automation Bootstrap
**Hostname:** `docs.stack.local` (Phase 7 - future)
**Dependencies:** docs-indexer (status.json)

## Purpose

Static site generator for project documentation using Material theme. Converts Markdown files in `docs/` to a searchable HTML site consuming live status from `docs/_data/status.json`.

## Configuration

**Image:** Built from `tools/mkdocs/Dockerfile` (Python 3.11 + mkdocs-material)
**Volumes:**
- `./docs:/docs/docs:ro` â€” Source Markdown files
- `./mkdocs.yml:/docs/mkdocs.yml:ro` â€” Site configuration
- `./site:/docs/site:rw` â€” Generated static HTML

**Networks:** default (ephemeral)
**Ports:** None (build-only container)

### Key Settings

**mkdocs.yml configuration:**
- Site name: "Datamancy Stack Documentation"
- Theme: Material (with features: navigation, search, toc)
- Plugins: search (future: macros for status.json consumption)
- Output: `site/` directory

**Build command:**
```bash
mkdocs build
```

### Fingerprint Inputs

- Image: Built from `tools/mkdocs/Dockerfile`
- Config file: `mkdocs.yml`
- Content: All files in `docs/` (Spokes, ADRs, README)
- Compose stanza: `services.mkdocs` block

## Access

- **Build-time only:** Generates static site to `site/`
- **Future (Phase 7):** `https://docs.stack.local` via Caddy
- **Local preview:** `python3 -m http.server 8000` in `site/`

## Runbook

### Build Documentation Site

```bash
# Build static site
docker compose run --rm mkdocs build

# Output to site/ directory
ls -la site/
```

### Local Preview

```bash
# Serve locally
cd site && python3 -m http.server 8000
# Open http://localhost:8000
```

### Update Configuration

Edit `mkdocs.yml` and rebuild:
```yaml
site_name: Datamancy Stack Documentation
theme:
  name: material
  features:
    - navigation.tabs
    - navigation.sections
    - search.suggest
```

### Common Issues

**Symptom:** Build fails with "No module named 'mkdocs'"
**Cause:** Missing dependency in Dockerfile
**Fix:** Verify `mkdocs-material` installed in image

**Symptom:** status.json data not visible in site
**Cause:** No template consuming `_data/status.json`
**Fix:** Add custom macros plugin or index.md template logic

**Symptom:** Navigation broken or pages missing
**Cause:** `mkdocs.yml` nav structure doesn't match file tree
**Fix:** Use auto-generated nav or update `nav:` section

## Testing

**Smoke test:** Run build; verify `site/index.html` exists with no errors.
**Last pass:** 2025-10-26 (Phase 0.5 implementation)
**Artifacts:** `site/` directory with static HTML

## Implementation Details

### Current Structure

```
docs/
â”œâ”€â”€ _data/
â”‚   â””â”€â”€ status.json (generated by docs-indexer)
â”œâ”€â”€ adr/
â”‚   â”œâ”€â”€ ADR-000-caddy-multi-hostname.md
â”‚   â”œâ”€â”€ ADR-001-freshness-fingerprints.md
â”‚   â””â”€â”€ ADR-002-observer-rbac.md
â”œâ”€â”€ spokes/
â”‚   â”œâ”€â”€ _TEMPLATE.md
â”‚   â”œâ”€â”€ caddy.md
â”‚   â”œâ”€â”€ grafana.md
â”‚   â””â”€â”€ ... (17 service Spokes)
â””â”€â”€ README.md
```

### Future Enhancements (Phase 7)

- Serve via Caddy at `docs.stack.local`
- Consume `status.json` for live badges
- Add macros plugin for dynamic content
- Integrate "Open last test run" links
- Search across all docs

## Related

- **Status source:** [docs-indexer](docs-indexer.md)
- **Content:** All Spoke docs, ADRs
- **Theme:** [Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)
- **Phase 7:** Landing page + docs site UI

---

**Update 2025-10-26:** Site builder functional. Currently generates static HTML from 3 ADRs and 17 Spoke docs. Phase 7 will add live status consumption and Caddy hosting at `docs.stack.local`.

**Last updated:** 2025-10-26
