# Datamancy Stack Configuration
# Single source of truth for installation and runtime settings
#
# This file consolidates all configuration previously scattered across:
# - storage.config.yaml
# - services.registry.yaml (service metadata)
# - Hardcoded defaults in scripts
#
# Edit this file, then run: ./install-datamancy.main.kts && cd ~/.datamancy && ./datamancy-controller.main.kts up

# ============================================================================
# Installation Settings
# ============================================================================
installation:
  # Where Datamancy installs (overrideable via CLI: ./install-datamancy.main.kts /custom/path)
  default_path: "${HOME}/.datamancy"

# ============================================================================
# Storage Configuration
# Different storage tiers for performance optimization
# ============================================================================
storage:
  # Vector databases (Qdrant) - fast SSD recommended for embedding search
  vector_dbs: "/mnt/sdc1_ctbx500_0385/datamancy/vector-dbs"

  # Relational/analytics databases (PostgreSQL, MariaDB, ClickHouse) - RAID for reliability
  non_vector_dbs: "/mnt/btrfs_raid_1_01_docker/volumes/databases"

  # Application data (Caddy, Grafana, BookStack, etc.) - RAID for reliability
  application_data: "/mnt/btrfs_raid_1_01_docker/volumes/applications"

# ============================================================================
# Runtime Configuration (Non-Sensitive)
# ============================================================================
runtime:
  # Primary domain for the stack (all services will be subdomains of this)
  domain: "latium.local"

  # Admin email for notifications and account creation
  admin_email: "admin@latium.local"

  # Admin username (non-sensitive, password is auto-generated)
  admin_user: "sysadmin"

# ============================================================================
# Container Image Versions
# Update versions here, then regenerate compose files with: process-templates.kts
# ============================================================================
images:
  # Core Infrastructure
  caddy: "2.8.4"
  ldap: "1.5.0"
  valkey: "8.0.1"
  authelia: "4.39.13"
  mailserver: "14.0.0"
  ldap_account_manager: "9.3"
  memcached: "1.6.39"
  docker_proxy: "v0.4.1"
  kopia: "0.18.2"

  # Databases
  postgres: "16.11"
  mariadb: "11.6.2"
  clickhouse: "24.8"
  qdrant: "v1.12.5"

  # Applications - Web
  grafana: "11.6.7"
  open_webui: "0.3.32"
  vaultwarden: "testing"
  bookstack: "24.12.1"
  planka: "1.26.3"
  forgejo: "9"
  homepage: "v1.7.0"
  jupyterhub: "latest"
  homeassistant: "stable"
  qbittorrent: "latest"

  # Applications - Communication
  synapse: "latest"
  element: "v1.11.88"
  mastodon: "v4.3.3"
  mastodon_streaming: "v4.3.3"
  roundcube: "latest"
  radicale: "latest"

  # Applications - Files
  seafile: "13.0.12"
  onlyoffice: "8.2.2"

  # AI/ML Services
  vllm: "latest"
  embedding_service: "cpu-1.2"
  litellm: "v1.74.9-stable.patch.1"

  # Datamancy Services
  benthos: "4.27.0"
  kotlin_runtime: "latest"
  temurin_jdk: "21-jdk"

# ============================================================================
# Resource Limits
# Tune these based on your hardware capabilities
# Format: {memory: "XG", cpus: "Y.Z"}
# ============================================================================
resources:
  postgres:
    memory: "4G"
    cpus: "2.0"

  mariadb:
    memory: "4G"
    cpus: "2.0"

  clickhouse:
    memory: "4G"
    cpus: "2.0"

  qdrant:
    memory: "2G"
    cpus: "2.0"

  vllm:
    memory: "16G"
    cpus: "12.0"

  mastodon:
    memory: "2G"
    cpus: "2.0"

# ============================================================================
# Startup Phases
# Services are started in phases with health checks between each phase
# Directory order determines startup sequence within each phase
# ============================================================================
phases:
  core:
    order: 1
    description: "Core infrastructure (caddy, ldap, valkey, authelia, mail)"
    timeout_seconds: 90
    compose_dirs:
      - "core"

  databases:
    order: 2
    description: "Database services (postgres, mariadb, clickhouse, qdrant)"
    timeout_seconds: 120
    compose_dirs:
      - "databases"

  applications:
    order: 3
    description: "Web applications (bookstack, grafana, open-webui, etc.)"
    timeout_seconds: 180
    compose_dirs:
      - "applications"

  datamancy:
    order: 4
    description: "Datamancy services (control-panel, search, indexer, ai)"
    timeout_seconds: 120
    compose_dirs:
      - "datamancy"
