# Auto-generated by build-datamancy.main.kts
# Image versions are HARDCODED at build time
# Only secrets and deployment paths use runtime ${VARS}

services:
  ldap-account-manager:
    image: ghcr.io/ldapaccountmanager/lam:9.4
    container_name: ldap-account-manager
    restart: unless-stopped
    networks:
      caddy:
        aliases:
          - lam.${DOMAIN}
      ldap:
        aliases:
          - lam.${DOMAIN}
    depends_on:
      ldap:
        condition: service_healthy
    environment:
      LDAP_DOMAIN: ${LDAP_DOMAIN}
      LDAP_BASE_DN: ${LDAP_BASE_DN}
      LDAP_USER: cn=admin,${LDAP_BASE_DN}
      LDAP_PASSWORD: ${LDAP_ADMIN_PASSWORD}
      LAM_PASSWORD: ${LDAP_ADMIN_PASSWORD}
      LAM_LANG: en_US
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/lam/templates/login.php"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
