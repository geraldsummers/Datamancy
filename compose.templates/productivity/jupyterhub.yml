# Auto-generated by build-datamancy.main.kts
# Image versions are HARDCODED at build time
# Only secrets and deployment paths use runtime ${VARS}

services:
  jupyterhub:
    image: datamancy-jupyterhub:5.4.3
    build:
      context: ./src/jupyterhub
      dockerfile: Dockerfile
    container_name: jupyterhub
    restart: unless-stopped
    networks:
      caddy:
        aliases:
          - jupyterhub.${DOMAIN}
      litellm:
        aliases:
          - jupyterhub.${DOMAIN}
      docker-proxy:
        aliases:
          - jupyterhub.${DOMAIN}
    depends_on:
      dind:
        condition: service_healthy
    environment:
      DOCKER_HOST: tcp://dind:2375
      DOCKER_NETWORK_NAME: datamancy-stack_litellm
      LITELLM_API_KEY: ${LITELLM_MASTER_KEY}
      JUPYTERHUB_CRYPT_KEY: ${JUPYTERHUB_CRYPT_KEY}
    volumes:
      - ./volumes/data/jupyterhub:/srv/jupyterhub
      - ./configs/applications/jupyterhub/jupyterhub_config.py:/srv/jupyterhub/jupyterhub_config.py:ro
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/hub/health || exit 1"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 90s
