# Auto-generated by build-datamancy.main.kts
# Image versions are HARDCODED at build time
# Only secrets and deployment paths use runtime ${VARS}

services:
  search-service:
    image: datamancy/search-service:local-build
    build:
      context: ./src/search-service
      dockerfile: Dockerfile
    container_name: search-service
    restart: unless-stopped
    networks:
      - qdrant
      - clickhouse
      - ai
    depends_on:
      qdrant:
        condition: service_started
      clickhouse:
        condition: service_started
      embedding-service:
        condition: service_started
    environment:
      SEARCH_SERVICE_PORT: 8098
      QDRANT_HOST: qdrant
      QDRANT_PORT: 6334
      QDRANT_API_KEY: ${QDRANT_API_KEY}
      CLICKHOUSE_HOST: clickhouse
      CLICKHOUSE_PORT: 8123
      CLICKHOUSE_USER: ${STACK_ADMIN_USER}
      CLICKHOUSE_PASSWORD: ${CLICKHOUSE_ADMIN_PASSWORD}
      EMBEDDING_SERVICE_URL: http://embedding-service:8080
    healthcheck:
      test: ["CMD-SHELL", "timeout 5 wget --quiet --tries=1 -O /dev/null http://127.0.0.1:8098/ || exit 1"]
      interval: 60s
      timeout: 20s
      retries: 3
      start_period: 180s
