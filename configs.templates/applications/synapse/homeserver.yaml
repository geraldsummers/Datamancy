# Synapse homeserver configuration
# This file must exist at /data/homeserver.yaml in the container

server_name: "matrix.{{DOMAIN}}"
pid_file: /data/homeserver.pid
public_baseurl: "https://matrix.{{DOMAIN}}/"
serve_server_wellknown: true

listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['0.0.0.0']
    resources:
      - names: [client, federation]
        compress: false

database:
  name: psycopg2
  allow_unsafe_locale: true
  args:
    user: synapse
    password: synapse_secure_pass_2024
    database: synapse
    host: postgres
    port: 5432
    cp_min: 5
    cp_max: 10

# Redis for worker coordination
redis:
  enabled: true
  host: redis-synapse
  port: 6379

log_config: "/data/matrix.{{DOMAIN}}.log.config"

media_store_path: /data/media_store
uploads_path: /data/uploads

max_upload_size: 50M

registration_shared_secret: "changeme_synapse_registration"
macaroon_secret_key: "changeme_synapse_macaroon"
form_secret: "changeme_synapse_form"

signing_key_path: "/data/matrix.{{DOMAIN}}.signing.key"

trusted_key_servers:
  - server_name: "matrix.org"

# Reporting
report_stats: true

# Registration
enable_registration: false
enable_registration_without_verification: false

# URL preview
url_preview_enabled: true
url_preview_ip_range_blacklist:
  - '127.0.0.0/8'
  - '10.0.0.0/8'
  - '172.16.0.0/12'
  - '192.168.0.0/16'
  - '100.64.0.0/10'
  - '169.254.0.0/16'
  - '::1/128'
  - 'fe80::/64'
  - 'fc00::/7'

# Trusted proxies
trusted_key_servers:
  - server_name: "matrix.org"

# Allow local network for federation
federation_ip_range_blacklist:
  - '127.0.0.0/8'
  - '10.0.0.0/8'
  - '172.16.0.0/12'
  - '192.168.0.0/16'
