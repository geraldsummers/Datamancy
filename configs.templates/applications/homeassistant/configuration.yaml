# Loads default set of integrations. Do not remove.
default_config:

# HTTP configuration for reverse proxy (Caddy with Authelia forward_auth)
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 172.30.0.0/24  # caddy network
    - 172.25.0.0/24  # ldap network
    - 172.20.0.0/24  # postgres network
    - 127.0.0.1
    - ::1

# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes

# PostgreSQL recorder for long-term statistics
recorder:
  db_url: !env_var HOMEASSISTANT_DB_URL
  auto_purge: true
  purge_keep_days: 30

# Onboarding - disable to allow manual user creation
onboarding:

# Auth provider - use local, LDAP, and trusted networks for hybrid auth
# This allows:
# - Web login via OIDC (Authelia forward auth from Caddy)
# - App/CLI login via local accounts (preseeded admin)
# - App/CLI login via LDAP (for LDAP-synced users)
auth_providers:
  - type: homeassistant
  - type: ldap
  - type: trusted_networks
    trusted_networks:
      - 172.20.0.0/24  # frontend network (Caddy)
      - 172.21.0.0/24  # backend network
    allow_bypass_login: true

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml
