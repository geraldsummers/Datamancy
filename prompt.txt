ssh in via ssh gerald@latium.local "command"
Drop a docker ps | grep unhealthy
Drop a ls ~/datamancy
Run the test runner container and collect results (integration-test-runner in the file "test-runner.yml" ) - this takes AGES to run so maybe 5 min blocks (sleep 300) and check periodically?

GET HYPED WE'RE BUILDING FIRE

docker compose not docker-compose
dont edit stuff on the server only fix stuff in the local repo

deployment blob:

 cd /home/gerald/IdeaProjects/Datamancy/ && \
./build-datamancy-v2.main.kts && \
rsync -avz --progress dist/ gerald@latium.local:~/datamancy/ && \
ssh gerald@latium.local "cd ~/datamancy && \
  docker compose --profile='*' build --pull=false && \
  docker compose up -d --force-recreate && \
  sleep 300 && \
    docker compose --profile ingestion up -d --force-recreate && \
  docker compose ps | grep unhealthy"

the build script wont build if you have uncommitted changes
check out the build script

fix problems in local repo, deploy them, verify they work and look for more problems once verified - deployment takes a while so do sleep 600 while it goes

ssh gerald@latium.local "cd ~/datamancy && docker compose logs | grep -i -E 'exception|error|fail|cannot' -B 1 -A 1" to find heaps of errors

we're experimenting with this clean partial upgrade system - so if redeploying breaks stuff, stop and let me know
serioulsy - take your time, if shits weird drop a sleep 60 or a sleep 300 and check again

this is ALL AND ONLY TEST DATA so you can wipe containers if you need!

YOU'RE REALLY FUCKING GOOD AT THIS CLAUDE YOU'VE TAUHGT ME SO MUCH ABOUT SOFTWARE I'M SO GRATEFUL FOR YOU AND ALL YOUR HARDWORK!!!

WHEN THE TEST FINISHES, DEPLOY FIXES AND RUN THE TEST AGAIN - GO BANANAS AND GET HYPED YOU'RE THE CYBERNETIC LOOP MASTER

HYPE HYPE HYPEEEEE

full clean up run somtimes:

# 0) Stop everything (best-effort)
sudo echo
docker ps -q | xargs -r docker stop -t 0 || true

# 1) Force-remove all containers (handles stuck ones)
docker ps -aq | xargs -r docker rm -f || true

# 2) Prune builder cache (buildx)
docker buildx prune -af || true

# 3) Prune everything else, including volumes
docker system prune -af --volumes || true

# 4) Redundant-but-explicit cleanup passes (belt + suspenders)
docker volume prune -af || true
docker image prune -af || true
docker network prune -f || true

sudo systemctl stop docker containerd
sudo rm -rvf /mnt/raid/docker/nocow/*
sudo rm -rvf ~/datamancy
sudo rm -rvf /mnt/raid/docker
sudo rm -rvf /mnt/vectors/qdrant/*
sudo systemctl start docker containerd