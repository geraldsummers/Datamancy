# Traefik Dynamic Configuration - Middlewares
# Provenance: https://doc.traefik.io/traefik/middlewares/overview/

http:
  middlewares:
    security-headers:
      headers:
        frameDeny: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        customFrameOptionsValue: "SAMEORIGIN"

    strip-prefix-grafana:
      stripPrefix:
        prefixes:
          - "/grafana"

    strip-prefix-browserless:
      stripPrefix:
        prefixes:
          - "/browserless"

    # Compression for better performance
    compress:
      compress: {}

    # OAuth2 Proxy error handling - redirect 401 to sign-in page
    oauth2-errors:
      errors:
        status:
          - "401-403"
        service: oauth2-proxy
        query: "/oauth2/sign_in?rd={url}"
